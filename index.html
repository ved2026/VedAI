<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal AI Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        [x-cloak] { display: none !important; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 font-sans antialiased" x-data="chatApp()" x-init="init()">

    <div class="flex h-screen overflow-hidden">
        
        <aside class="w-64 bg-gray-800 flex-shrink-0 flex flex-col border-r border-gray-700 transition-all duration-300"
               :class="sidebarOpen ? 'ml-0' : '-ml-64'">
            <div class="p-4 flex items-center justify-between">
                <button @click="startNewChat()" class="flex items-center justify-center w-full gap-2 border border-gray-600 rounded-lg p-2 hover:bg-gray-700 transition">
                    <span class="text-xl">+</span> New Chat
                </button>
            </div>
            
            <div class="flex-1 overflow-y-auto px-2 space-y-1">
                <template x-for="chat in history" :key="chat.id">
                    <div @click="loadChat(chat)" 
                         class="p-3 text-sm rounded-lg cursor-pointer hover:bg-gray-700 truncate flex justify-between items-center group"
                         :class="currentChatId === chat.id ? 'bg-gray-700' : ''">
                        <span x-text="chat.title"></span>
                        <button @click.stop="deleteChat(chat.id)" class="opacity-0 group-hover:opacity-100 text-gray-400 hover:text-red-400">×</button>
                    </div>
                </template>
            </div>

            <div class="p-4 border-t border-gray-700">
                <button @click="settingsModal = true" class="w-full text-left text-sm text-gray-400 hover:text-white flex items-center gap-2">
                    ⚙️ Settings
                </button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col relative">
            <header class="p-4 border-b border-gray-800 flex items-center gap-4">
                <button @click="sidebarOpen = !sidebarOpen" class="text-gray-400 hover:text-white">☰</button>
                <div class="text-sm font-medium">
                    Model: <span class="text-blue-400" x-text="settings.model"></span>
                </div>
            </header>

            <div id="chat-container" class="flex-1 overflow-y-auto p-4 md:p-8 space-y-6">
                <template x-for="(msg, index) in messages" :key="index">
                    <div class="flex gap-4 max-w-3xl mx-auto" :class="msg.role === 'user' ? 'justify-end' : 'justify-start'">
                        <div class="flex gap-3 max-w-[85%]" :class="msg.role === 'user' ? 'flex-row-reverse' : 'flex-row'">
                            <div class="w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0"
                                 :class="msg.role === 'user' ? 'bg-blue-600' : 'bg-emerald-600'">
                                <span x-text="msg.role === 'user' ? 'U' : 'AI'"></span>
                            </div>
                            <div class="bg-gray-800 rounded-2xl p-4 shadow-sm"
                                 :class="msg.role === 'user' ? 'rounded-tr-none' : 'rounded-tl-none'">
                                <p class="text-sm leading-relaxed whitespace-pre-wrap" x-text="msg.content"></p>
                            </div>
                        </div>
                    </div>
                </template>
                <div x-show="loading" class="max-w-3xl mx-auto flex gap-4">
                    <div class="animate-pulse flex space-x-2">
                        <div class="h-2 w-2 bg-gray-500 rounded-full"></div>
                        <div class="h-2 w-2 bg-gray-500 rounded-full"></div>
                        <div class="h-2 w-2 bg-gray-500 rounded-full"></div>
                    </div>
                </div>
            </div>

            <div class="p-4 border-t border-gray-800 bg-gray-900">
                <div class="max-w-3xl mx-auto relative">
                    <textarea x-model="userInput" 
                              @keydown.enter.prevent="sendMessage()"
                              placeholder="Message Gemini..." 
                              class="w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 pr-12 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"
                              rows="1"></textarea>
                    <button @click="sendMessage()" 
                            class="absolute right-3 bottom-3 text-blue-500 hover:text-blue-400 font-bold">
                        ▲
                    </button>
                </div>
                <p class="text-[10px] text-center mt-2 text-gray-500">Static AI Shell v1.0 - Connected via OpenRouter</p>
            </div>
        </main>

        <div x-show="settingsModal" x-cloak class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
            <div class="bg-gray-800 rounded-xl max-w-md w-full p-6 border border-gray-700">
                <h2 class="text-xl font-bold mb-4">API Settings</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs text-gray-400 mb-1">OpenRouter API Key</label>
                        <input type="password" x-model="settings.apiKey" class="w-full bg-gray-900 border border-gray-700 rounded p-2 focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-400 mb-1">Model Name</label>
                        <input type="text" x-model="settings.model" placeholder="google/gemini-pro-1.5" class="w-full bg-gray-900 border border-gray-700 rounded p-2">
                    </div>
                </div>
                <div class="mt-6 flex justify-end gap-3">
                    <button @click="saveSettings()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded font-medium">Save & Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function chatApp() {
            return {
                sidebarOpen: true,
                settingsModal: false,
                loading: false,
                userInput: '',
                currentChatId: null,
                messages: [],
                history: [],
                settings: {
                    apiKey: '',
                    model: 'google/gemini-2.0-flash-001'
                },

                init() {
                    const savedSettings = localStorage.getItem('chat_settings');
                    if (savedSettings) this.settings = JSON.parse(savedSettings);
                    
                    const savedHistory = localStorage.getItem('chat_history');
                    if (savedHistory) this.history = JSON.parse(savedHistory);
                    
                    if (this.history.length > 0) {
                        this.loadChat(this.history[0]);
                    } else {
                        this.startNewChat();
                    }
                },

                saveSettings() {
                    localStorage.setItem('chat_settings', JSON.stringify(this.settings));
                    this.settingsModal = false;
                },

                startNewChat() {
                    this.currentChatId = Date.now();
                    this.messages = [];
                    this.userInput = '';
                },

                loadChat(chat) {
                    this.currentChatId = chat.id;
                    this.messages = chat.messages;
                },

                deleteChat(id) {
                    this.history = this.history.filter(c => c.id !== id);
                    localStorage.setItem('chat_history', JSON.stringify(this.history));
                    if (this.currentChatId === id) this.startNewChat();
                },

                async sendMessage() {
                    if (!this.userInput.trim() || !this.settings.apiKey) {
                        if(!this.settings.apiKey) alert('Please add your API key in Settings');
                        return;
                    }

                    const userContent = this.userInput;
                    this.messages.push({ role: 'user', content: userContent });
                    this.userInput = '';
                    this.loading = true;

                    // Scroll to bottom
                    this.$nextTick(() => {
                        const container = document.getElementById('chat-container');
                        container.scrollTop = container.scrollHeight;
                    });

                    try {
                        const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                            method: "POST",
                            headers: {
                                "Authorization": `Bearer ${this.settings.apiKey}`,
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify({
                                "model": this.settings.model,
                                "messages": this.messages
                            })
                        });

                        const data = await response.json();
                        const aiMessage = data.choices[0].message.content;
                        
                        this.messages.push({ role: 'assistant', content: aiMessage });
                        this.updateHistory(userContent);
                    } catch (error) {
                        this.messages.push({ role: 'assistant', content: 'Error: Could not reach the API. Check your key and connection.' });
                    } finally {
                        this.loading = false;
                        this.$nextTick(() => {
                            const container = document.getElementById('chat-container');
                            container.scrollTop = container.scrollHeight;
                        });
                    }
                },

                updateHistory(firstQuery) {
                    const existingIdx = this.history.findIndex(c => c.id === this.currentChatId);
                    if (existingIdx > -1) {
                        this.history[existingIdx].messages = [...this.messages];
                    } else {
                        this.history.unshift({
                            id: this.currentChatId,
                            title: firstQuery.substring(0, 30) + '...',
                            messages: [...this.messages]
                        });
                    }
                    localStorage.setItem('chat_history', JSON.stringify(this.history));
                }
            }
        }
    </script>
</body>
</html>
